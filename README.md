# Islandora Collection Search

Islandora Collection Search is a Drupal module that allows for searching within a collection using Solr. It provides a more robust replacement for islandora_solr_search's 'Simple Search' block, and it automatically handles appropriate Solr re-indexes when records are moved between collections in Fedora.

## Dependencies

This module requires the following modules/libraries:
* [Islandora](https://github.com/Islandora/islandora)
* [Islandora Solr Search](https://github.com/Islandora/islandora_solr_search)
* [Islandora Solution Pack Collection](https://github.com/Islandora/islandora_solution_pack_collection)

## Installation

  1. Install as usual, see [this](https://drupal.org/documentation/install/modules-themes/modules-7) for further information.
  2. Ensure that a multivalued string field is being indexed in Solr containing the PIDs of each ancestor of an object. If you are using discoverygarden's [basic-solr-config](https://github.com/discoverygarden/basic-solr-config?source=c), this is the `ancestors_ms` field, which is not generated by default. [A `hierarchy.xslt` template is provided in discoverygarden's islandora_transforms](https://github.com/discoverygarden/islandora_transforms/blob/master/hierarchy.xslt) to traverse ancestors in the graph, from which such a field can be made.
      * The simplest way to enable this field is to use the latest version of `basic-solr-config` and the discoverygarden fork of [gsearch 2.9.x](https://github.com/discoverygarden/gsearch/releases/tag/v2.9.1), then follow `basic-solr-config`'s `README.md` to create a `custom_parameters.properties` file.
      * Otherwise, `hierarchy.xslt` will have to be manually implemented. If using the `basic-solr-config`'s `foxmlToSolr.xslt`, there may be existing XSLT that can be uncommented to enable the indexing of ancestors; otherwise, you can manually add them. These sections include the [code to call and use the ancestors template](https://github.com/discoverygarden/basic-solr-config/blob/f708db71dca0ecba81af6a0662b02a0ef44153b8/foxmlToSolr.xslt#L305-L313), the [XSLT include statements required to use the ancestors template](https://github.com/discoverygarden/basic-solr-config/blob/f708db71dca0ecba81af6a0662b02a0ef44153b8/foxmlToSolr.xslt#L126-L127), and [any required namespaces](https://github.com/discoverygarden/basic-solr-config/blob/f708db71dca0ecba81af6a0662b02a0ef44153b8/foxmlToSolr.xslt#L27-L29).
      * If newly implementing this field on an existing site with repository content, Solr will need to be reindexed.
  3. Set up the 'Islandora Collection Search' block. It can replace the standard 'Islandora simple search' block.
  4. Ensure the ancestors hierarchy field created in step 2 is configured in `admin/islandora/tools/collection_search` as the **Ancestor field**, as well as connection information for GSearch.

## Configuration

### Configuring the Module

The configuration page for the module can be found at `yoursite.com/admin/islandora/tools/collection_search`.
* The 'Ancestor field' is set to 'ancestors_ms' by default.
* Configure the 'GSearch Config' section with the proper credentials.
* The options in the 'Collections' section of that page provide ways to configure the UI, such as having a drop-down menu of certain collections that can be searched from anywhere on your site where the 'Collection Search' block is enabled.

### Configuring the Block

The configuration page for the 'Islandora Collection Search' block can be found at `yoursite.com/admin/structure/block/manage/islandora_collection_search/islandora_collection_search/configure`. The main configuration you might want to do is to define which pages display the block for which Roles and/or Users. That can be managed in the 'Visibility settings' section of this block's configuration page.

## Usage

This module provides a block that works like the 'Simple Search' block, but it can narrow the search to objects within a given collection. However, it also has the option to search all collections, which would result in functionality identical to the 'Simple Search' block.

If all the [Installation](#installation) and [Configuration](#configuration) steps have been successfully completed, the powerful and user friendly 'Collection Search' block should now be available.

## Troubleshooting/Issues

Having problems or solved a problem? Contact [discoverygarden](http://support.discoverygarden.ca).
  
## Maintainers/Sponsors
Current maintainers:

* [discoverygarden](https://github.com/discoverygarden)

## Development

If you would like to contribute to this module, please check out our helpful
[Documentation for Developers](https://github.com/Islandora/islandora/wiki#wiki-documentation-for-developers)
info, [Developers](http://islandora.ca/developers) section on Islandora.ca, and
contact [discoverygarden](http://support.discoverygarden.ca).

## License

[GPLv3](http://www.gnu.org/licenses/gpl-3.0.txt)
